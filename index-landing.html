<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeVerse - Play. Learn. Code.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/animations.css">
    
    <!-- Font Awesome for Icons - Deferred -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- Typed.js for typing animation - Deferred -->
    <script defer src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Poppins:wght@400;600;700;900&display=swap');
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .hero-title {
            font-size: 5rem;
            font-weight: 900;
            background: linear-gradient(90deg, #7b3fe8, #a3b0ff, #7b3fe8);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tagline {
            font-size: 2rem;
            color: #a3b0ff;
            font-weight: 600;
            display: inline-block;
            min-height: 2.5rem;
        }
        
        /* Typed.js cursor styling */
        .typed-cursor {
            color: #a3b0ff;
            font-size: 2rem;
            font-weight: 600;
        }
        
        .feature-card {
            background: rgba(44, 44, 84, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(163, 176, 255, 0.2);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-glow {
            box-shadow: 0 0 30px rgba(123, 63, 232, 0.6);
        }
        
        .btn-glow:hover {
            box-shadow: 0 0 50px rgba(123, 63, 232, 0.9);
        }

        /* Particle Background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(163, 176, 255, 0.5);
            border-radius: 50%;
            animation: float 20s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(100px); opacity: 0; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Particle Background -->
    <div class="particles" id="particles"></div>

    <!-- Navigation -->
    <nav class="relative z-10 p-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="text-3xl font-bold text-white">
                <span class="text-gradient-animated">CodeVerse</span>
            </div>
            <div class="space-x-4">
                <button onclick="showAuthModal('login')" 
                        class="px-6 py-2 rounded-lg text-white hover:bg-white/10 transition-all">
                    Login
                </button>
                <button onclick="showAuthModal('signup')" 
                        class="px-6 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 transition-all btn-glow">
                    Get Started
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <main class="relative z-10 flex-grow flex items-center justify-center px-6">
        <div class="max-w-6xl mx-auto text-center">
            <!-- Main Title with Staggered Animation -->
            <div class="mb-8">
                <h1 class="hero-title mb-4 stagger-item">CodeVerse</h1>
                <div class="tagline stagger-item" style="animation-delay: 0.5s;">
                    <span id="typing-text"></span>
                </div>
            </div>

            <!-- Description -->
            <p class="text-xl text-gray-300 mb-12 max-w-3xl mx-auto stagger-item" style="animation-delay: 0.8s;">
                Master Computer Science through gamified learning, interactive simulations, 
                and AI-powered personalization. Your journey to coding excellence starts here.
            </p>

            <!-- CTA Buttons -->
            <div class="flex justify-center space-x-6 mb-16 stagger-item" style="animation-delay: 1s;">
                <button onclick="showAuthModal('signup')" 
                        class="px-10 py-4 rounded-lg bg-purple-600 text-white text-lg font-bold hover:bg-purple-700 transition-all btn-glow ripple-button">
                    Start Learning Free ðŸš€
                </button>
                <button onclick="scrollToFeatures()" 
                        class="px-10 py-4 rounded-lg glass-effect text-white text-lg font-semibold hover:bg-white/10 transition-all">
                    Explore Features
                </button>
                <!-- Quick test onboarding without signing up -->
                <a href="index.html?onboarding=true" class="px-6 py-3 rounded-lg bg-yellow-500 text-black font-semibold hover:opacity-90 transition-all">
                    Try Onboarding
                </a>
            </div>

            <!-- Feature Cards -->
            <div id="features" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-16">
                <!-- Profile Building -->
                <div class="feature-card p-6 rounded-xl stagger-item" style="animation-delay: 1.2s;">
                    <div class="text-5xl mb-4 text-purple-400">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Profile Building</h3>
                    <p class="text-gray-400 text-sm">
                        Personalized learning paths based on your goals, pace, and preferences
                    </p>
                </div>

                <!-- Core Concepts -->
                <div class="feature-card p-6 rounded-xl stagger-item" style="animation-delay: 1.4s;">
                    <div class="text-5xl mb-4 text-blue-400">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Core Concepts</h3>
                    <p class="text-gray-400 text-sm">
                        12+ subjects covering DSA, OS, Networks, AI/ML, Cloud, and more
                    </p>
                </div>

                <!-- Gamified Learning -->
                <div class="feature-card p-6 rounded-xl stagger-item" style="animation-delay: 1.6s;">
                    <div class="text-5xl mb-4 text-green-400">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Gamified Learning</h3>
                    <p class="text-gray-400 text-sm">
                        Interactive games, quizzes, and challenges with XP, streaks, and rewards
                    </p>
                </div>

                <!-- Multimodal Approach -->
                <div class="feature-card p-6 rounded-xl stagger-item" style="animation-delay: 1.8s;">
                    <div class="text-5xl mb-4 text-yellow-400">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Multimodal Learning</h3>
                    <p class="text-gray-400 text-sm">
                        Videos, coding terminals, AI tutor, and hands-on simulations
                    </p>
                </div>
            </div>

            <!-- Additional Features -->
            <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-effect p-6 rounded-xl stagger-item" style="animation-delay: 2s;">
                    <div class="text-4xl mb-3 text-purple-400">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h4 class="text-lg font-bold text-white mb-2">AI Tutor "Tuto"</h4>
                    <p class="text-gray-400 text-sm">Your personal AI mentor guiding you through every concept</p>
                </div>

                <div class="glass-effect p-6 rounded-xl stagger-item" style="animation-delay: 2.2s;">
                    <div class="text-4xl mb-3 text-blue-400">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <h4 class="text-lg font-bold text-white mb-2">Interview Prep</h4>
                    <p class="text-gray-400 text-sm">Coding challenges, mock interviews, and resume building</p>
                </div>

                <div class="glass-effect p-6 rounded-xl stagger-item" style="animation-delay: 2.4s;">
                    <div class="text-4xl mb-3 text-yellow-400">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h4 class="text-lg font-bold text-white mb-2">Achievements</h4>
                    <p class="text-gray-400 text-sm">Earn characters, badges, and climb the leaderboard</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="relative z-10 text-center p-6 text-gray-400">
        <p>&copy; 2024 CodeVerse - Where Learning Meets Gaming ðŸŽ®âœ¨</p>
    </footer>

    <!-- Auth Modal -->
    <div id="auth-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-6">
        <div class="glass-effect rounded-2xl p-8 max-w-md w-full scale-up">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modal-title" class="text-3xl font-bold text-white">Welcome Back</h2>
                <button onclick="closeAuthModal()" class="text-gray-400 hover:text-white text-2xl">Ã—</button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="space-y-4">
                <input type="email" id="login-email" placeholder="Email" 
                       class="w-full p-4 rounded-lg bg-gray-800/50 border border-gray-700 text-white focus:border-purple-500 focus:outline-none">
                <input type="password" id="login-password" placeholder="Password" 
                       class="w-full p-4 rounded-lg bg-gray-800/50 border border-gray-700 text-white focus:border-purple-500 focus:outline-none">
                <p id="login-error" class="text-red-400 text-sm h-4"></p>
                
                <button onclick="handleAuth('login')" 
                        class="w-full p-4 rounded-lg bg-purple-600 text-white font-bold hover:bg-purple-700 transition-all ripple-button">
                    Login
                </button>

                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-700"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-gray-900 text-gray-400">Or continue with</span>
                    </div>
                </div>

                <button onclick="handleGoogleAuth()" 
                        class="w-full p-4 rounded-lg bg-white text-gray-900 font-semibold hover:bg-gray-100 transition-all flex items-center justify-center">
                    <svg class="w-6 h-6 mr-2" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Sign in with Google
                </button>

                <p class="text-center text-sm text-gray-400 mt-4">
                    Don't have an account? 
                    <a href="#" onclick="switchAuthMode('signup')" class="text-purple-400 hover:underline">Sign up</a>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="hidden space-y-4">
                <input type="email" id="signup-email" placeholder="Email" 
                       class="w-full p-4 rounded-lg bg-gray-800/50 border border-gray-700 text-white focus:border-purple-500 focus:outline-none">
                <input type="password" id="signup-password" placeholder="Password (min 6 characters)" 
                       class="w-full p-4 rounded-lg bg-gray-800/50 border border-gray-700 text-white focus:border-purple-500 focus:outline-none">
                <p id="signup-error" class="text-red-400 text-sm h-4"></p>
                
                <button onclick="handleAuth('signup')" 
                        class="w-full p-4 rounded-lg bg-purple-600 text-white font-bold hover:bg-purple-700 transition-all ripple-button">
                    Create Account
                </button>

                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-700"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-gray-900 text-gray-400">Or continue with</span>
                    </div>
                </div>

                <button onclick="handleGoogleAuth()" 
                        class="w-full p-4 rounded-lg bg-white text-gray-900 font-semibold hover:bg-gray-100 transition-all flex items-center justify-center">
                    <svg class="w-6 h-6 mr-2" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Sign up with Google
                </button>

                <p class="text-center text-sm text-gray-400 mt-4">
                    Already have an account? 
                    <a href="#" onclick="switchAuthMode('login')" class="text-purple-400 hover:underline">Login</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Firebase & Auth Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, 
                 signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA92E7a67gbSmNCN5w_f65vMq4NNHbWuAA",
            authDomain: "codeverse-80575.firebaseapp.com",
            projectId: "codeverse-80575",
            storageBucket: "codeverse-80575.firebasestorage.app",
            messagingSenderId: "586270087321",
            appId: "1:586270087321:web:c1b159d173173206844008",
            measurementId: "G-G5QFP52K2G"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        // Check auth state and auto-redirect if user is already signed in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.info('User already signed in, redirecting to app...');
                window.location.href = 'index.html';
            }
        });

        // Handle Email/Password Auth
        window.handleAuth = async (mode) => {
            const email = document.getElementById(`${mode}-email`).value.trim();
            const password = document.getElementById(`${mode}-password`).value;
            const errorElement = document.getElementById(`${mode}-error`);
            
            errorElement.textContent = '';
            
            if (!email || !password) {
                errorElement.textContent = 'Email and password are required.';
                return;
            }

            try {
                if (mode === 'signup') {
                    await createUserWithEmailAndPassword(auth, email, password);
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                }
                // Redirect to main app
                window.location.href = 'index.html';
            } catch (error) {
                // Log full error for debugging (includes code and full message)
                console.error('Auth error during', mode, error);

                const code = error && error.code ? error.code : '';
                const rawMessage = error && error.message ? error.message : 'An unknown error occurred.';

                // Map common Firebase auth error codes to friendly messages
                let friendlyMessage = '';
                switch (code) {
                    case 'auth/wrong-password':
                        friendlyMessage = 'Incorrect password. Please try again.';
                        break;
                    case 'auth/user-not-found':
                        friendlyMessage = 'No account found with this email.';
                        break;
                    case 'auth/invalid-email':
                        friendlyMessage = 'The email address is not valid.';
                        break;
                    case 'auth/too-many-requests':
                        friendlyMessage = 'Too many failed attempts. Try again later.';
                        break;
                    case 'auth/network-request-failed':
                        friendlyMessage = 'Network error. Check your internet connection.';
                        break;
                    case 'auth/invalid-api-key':
                        friendlyMessage = 'Invalid Firebase API key. Check your firebaseConfig.';
                        break;
                    case 'auth/operation-not-allowed':
                        friendlyMessage = 'This sign-in method is not enabled in the Firebase Console.';
                        break;
                    default:
                        // Strip the verbose Firebase prefix if present
                        friendlyMessage = rawMessage.replace('Firebase: ', '').replace('auth/', '');
                }

                if (errorElement) {
                    errorElement.textContent = friendlyMessage;
                } else {
                    alert(friendlyMessage);
                }
            }
        };

        // Handle Google Auth
        window.handleGoogleAuth = async () => {
            const errorElement = document.getElementById('login-error') || document.getElementById('signup-error');
            
            try {
                console.log('Attempting Google sign-in...');
                
                // Force account selection
                googleProvider.setCustomParameters({
                    prompt: 'select_account'
                });
                
                const result = await signInWithPopup(auth, googleProvider);
                console.log('Google sign-in successful:', result.user.email);
                // Redirect to main app
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Google auth error:', error);
                console.error('Error code:', error.code);
                console.error('Error message:', error.message);
                
                let errorMessage = 'Google sign-in failed. ';
                
                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage += 'Popup was closed before completing sign-in.';
                } else if (error.code === 'auth/popup-blocked') {
                    errorMessage += 'Popup was blocked by browser. Please allow popups.';
                } else if (error.code === 'auth/unauthorized-domain') {
                    errorMessage += 'Domain not authorized.\n\nTO FIX: Go to Firebase Console â†’ Authentication â†’ Settings â†’ Authorized domains\nAdd: 127.0.0.1';
                } else if (error.code === 'auth/operation-not-allowed') {
                    errorMessage += 'Google sign-in is not enabled. Please enable it in Firebase Console.';
                } else {
                    errorMessage += error.message;
                }
                
                if (errorElement) {
                    errorElement.textContent = errorMessage;
                }
                alert(errorMessage);
            }
        };
    </script>

    <script>
        // Create particles
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                container.appendChild(particle);
            }
        }

        // Modal functions
        function showAuthModal(mode) {
            document.getElementById('auth-modal').classList.remove('hidden');
            switchAuthMode(mode);
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
        }

        function switchAuthMode(mode) {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const modalTitle = document.getElementById('modal-title');

            if (mode === 'login') {
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                modalTitle.textContent = 'Welcome Back';
            } else {
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                modalTitle.textContent = 'Join CodeVerse';
            }
        }

        function scrollToFeatures() {
            document.getElementById('features').scrollIntoView({ behavior: 'smooth' });
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAuthModal();
            }
        });

        // Close modal on outside click
        document.getElementById('auth-modal').addEventListener('click', (e) => {
            if (e.target.id === 'auth-modal') {
                closeAuthModal();
            }
        });

        // Initialize Typed.js for typing animation
        function initTypingEffect() {
            // Wait for Typed.js to load
            if (typeof Typed === 'undefined') {
                // Show static text while loading
                document.getElementById('typing-text').textContent = 'Play. Learn. Code.';
                setTimeout(initTypingEffect, 100);
                return;
            }
            
            var typed = new Typed("#typing-text", {
                strings: ["Play. Learn. Code."],
                typeSpeed: 100,
                backSpeed: 50,
                backDelay: 3000,
                startDelay: 500,
                loop: true,
                showCursor: true,
                cursorChar: '|'
            });
        }

        // Initialize immediately - don't wait for DOMContentLoaded
        createParticles();
        
        // Initialize typing effect when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initTypingEffect);
        } else {
            initTypingEffect();
        }
    </script>
</body>
